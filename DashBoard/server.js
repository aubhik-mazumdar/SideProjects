const express = require('express');
const app = express();

const fs = require('fs');
const URL = require('url');
const PATH = require('path');
const https = require('https');
const config = require('./config.js');

const fetch = function(url, https, URLModule, headers) {
	return new Promise((resolve, reject) => {
		const options = URLModule.parse(url);

		options.headers = headers;
		https.get(options, res => {
			let rawData = '';

			const {statusCode} = res;
			const contentType = res.headers['content-type'];

			if (statusCode !== 200) {
				reject('Request Failed.\n' + `Status Code: ${statusCode}`);
				res.resume();
				return;
			}

			res.setEncoding('utf8');

			res.on('data', chunk => {rawData += chunk;});
			res.on('end', () => {
				if (/^application\/json/.test(contentType)) {
					try {
						resolve(JSON.parse(rawData));
					} catch(err) {
						reject(err);
					}
				} else resolve(rawData);
			});
		}).on('error', err => reject(err));
	});
}

app.get('/weather*', (request, response) => {
	const coords = request.url.replace('/weather/', '');
	const url = `https://api.darksky.net/forecast/${config.weather.apiKey}/${coords}/?units=si`;

	fetch(url, https, URL).then(data => {
		response.send({success: true, data: data});
	}).catch(err => {
		response.send({success: false, error: err})
	});

	// response.send({"success":true,"data":{"latitude":51.4118686,"longitude":5.7510465,"timezone":"Europe/Amsterdam","currently":{"time":1507988189,"summary":"Clear","icon":"clear-day","precipIntensity":0,"precipProbability":0,"temperature":21.89,"apparentTemperature":21.94,"dewPoint":15.95,"humidity":0.69,"pressure":1025.53,"windSpeed":2.69,"windGust":4.93,"windBearing":235,"cloudCover":0.16,"uvIndex":1,"visibility":9.43,"ozone":259.98},"hourly":{"summary":"Clear throughout the day.","icon":"clear-day","data":[{"time":1507986000,"summary":"Clear","icon":"clear-day","precipIntensity":0,"precipProbability":0,"temperature":21.7,"apparentTemperature":21.76,"dewPoint":16.04,"humidity":0.7,"pressure":1025.76,"windSpeed":2.73,"windGust":5.12,"windBearing":234,"cloudCover":0.18,"uvIndex":2,"visibility":9.43,"ozone":260.65},{"time":1507989600,"summary":"Clear","icon":"clear-day","precipIntensity":0,"precipProbability":0,"temperature":22.02,"apparentTemperature":22.06,"dewPoint":15.89,"humidity":0.68,"pressure":1025.39,"windSpeed":2.66,"windGust":4.81,"windBearing":236,"cloudCover":0.15,"uvIndex":1,"visibility":9.43,"ozone":259.55},{"time":1507993200,"summary":"Clear","icon":"clear-day","precipIntensity":0,"precipProbability":0,"temperature":21.58,"apparentTemperature":21.58,"dewPoint":15.33,"humidity":0.68,"pressure":1025.18,"windSpeed":2.75,"windGust":4.46,"windBearing":235,"cloudCover":0.09,"uvIndex":1,"visibility":9.43,"ozone":258.64},{"time":1507996800,"summary":"Clear","icon":"clear-day","precipIntensity":0,"precipProbability":0,"temperature":20.32,"apparentTemperature":20.32,"dewPoint":14.62,"humidity":0.7,"pressure":1025.28,"windSpeed":2.7,"windGust":3.75,"windBearing":230,"cloudCover":0.03,"uvIndex":0,"visibility":9.43,"ozone":258.12},{"time":1508000400,"summary":"Clear","icon":"clear-night","precipIntensity":0,"precipProbability":0,"temperature":18.53,"apparentTemperature":18.53,"dewPoint":14.09,"humidity":0.75,"pressure":1025.52,"windSpeed":2.32,"windGust":2.75,"windBearing":224,"cloudCover":0,"uvIndex":0,"visibility":9.43,"ozone":257.76},{"time":1508004000,"summary":"Clear","icon":"clear-night","precipIntensity":0.0025,"precipProbability":0.01,"precipType":"rain","temperature":17.17,"apparentTemperature":17.17,"dewPoint":13.78,"humidity":0.81,"pressure":1025.74,"windSpeed":1.88,"windGust":1.98,"windBearing":216,"cloudCover":0,"uvIndex":0,"ozone":257.28},{"time":1508007600,"summary":"Clear","icon":"clear-night","precipIntensity":0.0025,"precipProbability":0.01,"precipType":"rain","temperature":16.31,"apparentTemperature":16.31,"dewPoint":13.51,"humidity":0.84,"pressure":1025.89,"windSpeed":1.72,"windGust":1.77,"windBearing":206,"cloudCover":0,"uvIndex":0,"ozone":256.55},{"time":1508011200,"summary":"Clear","icon":"clear-night","precipIntensity":0.0025,"precipProbability":0.01,"precipType":"rain","temperature":15.73,"apparentTemperature":15.73,"dewPoint":13.23,"humidity":0.85,"pressure":1025.98,"windSpeed":1.7,"windGust":1.85,"windBearing":194,"cloudCover":0,"uvIndex":0,"ozone":255.73},{"time":1508014800,"summary":"Clear","icon":"clear-night","precipIntensity":0.0025,"precipProbability":0.01,"precipType":"rain","temperature":15.16,"apparentTemperature":15.16,"dewPoint":12.92,"humidity":0.86,"pressure":1026,"windSpeed":1.73,"windGust":2.08,"windBearing":185,"cloudCover":0,"uvIndex":0,"ozone":254.96},{"time":1508018400,"summary":"Clear","icon":"clear-night","precipIntensity":0.0025,"precipProbability":0.01,"precipType":"rain","temperature":14.61,"apparentTemperature":14.61,"dewPoint":12.56,"humidity":0.88,"pressure":1025.97,"windSpeed":1.83,"windGust":2.48,"windBearing":178,"cloudCover":0,"uvIndex":0,"ozone":254.31},{"time":1508022000,"summary":"Clear","icon":"clear-night","precipIntensity":0.0051,"precipProbability":0.01,"precipType":"rain","temperature":14.18,"apparentTemperature":14.18,"dewPoint":12.17,"humidity":0.88,"pressure":1025.85,"windSpeed":1.98,"windGust":3,"windBearing":172,"cloudCover":0,"uvIndex":0,"ozone":253.91},{"time":1508025600,"summary":"Clear","icon":"clear-night","precipIntensity":0.0025,"precipProbability":0.01,"precipType":"rain","temperature":13.86,"apparentTemperature":13.86,"dewPoint":11.74,"humidity":0.87,"pressure":1025.65,"windSpeed":2.1,"windGust":3.38,"windBearing":169,"cloudCover":0,"uvIndex":0,"ozone":253.3},{"time":1508029200,"summary":"Clear","icon":"clear-night","precipIntensity":0.0025,"precipProbability":0.01,"precipType":"rain","temperature":13.57,"apparentTemperature":13.57,"dewPoint":11.22,"humidity":0.86,"pressure":1025.34,"windSpeed":2.16,"windGust":3.43,"windBearing":168,"cloudCover":0,"uvIndex":0,"ozone":252.69},{"time":1508032800,"summary":"Clear","icon":"clear-night","precipIntensity":0,"precipProbability":0,"temperature":13.23,"apparentTemperature":13.23,"dewPoint":10.68,"humidity":0.85,"pressure":1024.91,"windSpeed":2.19,"windGust":3.33,"windBearing":170,"cloudCover":0,"uvIndex":0,"ozone":252.15},{"time":1508036400,"summary":"Clear","icon":"clear-night","precipIntensity":0,"precipProbability":0,"temperature":12.84,"apparentTemperature":12.84,"dewPoint":10.21,"humidity":0.84,"pressure":1024.61,"windSpeed":2.26,"windGust":3.27,"windBearing":170,"cloudCover":0,"uvIndex":0,"ozone":251.53},{"time":1508040000,"summary":"Clear","icon":"clear-night","precipIntensity":0,"precipProbability":0,"temperature":11.87,"apparentTemperature":11.87,"dewPoint":9.79,"humidity":0.87,"pressure":1024.44,"windSpeed":2.36,"windGust":3.19,"windBearing":167,"cloudCover":0,"uvIndex":0,"ozone":250.95},{"time":1508043600,"summary":"Clear","icon":"clear-night","precipIntensity":0,"precipProbability":0,"temperature":11.26,"apparentTemperature":11.26,"dewPoint":9.43,"humidity":0.89,"pressure":1024.35,"windSpeed":2.48,"windGust":3.13,"windBearing":163,"cloudCover":0,"uvIndex":0,"ozone":250.25},{"time":1508047200,"summary":"Clear","icon":"clear-night","precipIntensity":0,"precipProbability":0,"temperature":11.3,"apparentTemperature":11.3,"dewPoint":9.38,"humidity":0.88,"pressure":1024.27,"windSpeed":2.67,"windGust":3.38,"windBearing":161,"cloudCover":0,"uvIndex":0,"ozone":249.85},{"time":1508050800,"summary":"Clear","icon":"clear-day","precipIntensity":0,"precipProbability":0,"temperature":12.31,"apparentTemperature":12.31,"dewPoint":9.81,"humidity":0.85,"pressure":1024.18,"windSpeed":3.01,"windGust":4.24,"windBearing":167,"cloudCover":0,"uvIndex":0,"ozone":249.75},{"time":1508054400,"summary":"Clear","icon":"clear-day","precipIntensity":0,"precipProbability":0,"temperature":14.03,"apparentTemperature":14.03,"dewPoint":10.54,"humidity":0.8,"pressure":1024.14,"windSpeed":3.43,"windGust":5.43,"windBearing":174,"cloudCover":0,"uvIndex":1,"ozone":249.7},{"time":1508058000,"summary":"Clear","icon":"clear-day","precipIntensity":0,"precipProbability":0,"temperature":15.78,"apparentTemperature":15.78,"dewPoint":11.24,"humidity":0.74,"pressure":1023.95,"windSpeed":3.8,"windGust":6.28,"windBearing":182,"cloudCover":0,"uvIndex":1,"ozone":249.79},{"time":1508061600,"summary":"Clear","icon":"clear-day","precipIntensity":0,"precipProbability":0,"temperature":17.71,"apparentTemperature":17.71,"dewPoint":11.83,"humidity":0.68,"pressure":1023.63,"windSpeed":4.04,"windGust":6.46,"windBearing":185,"cloudCover":0,"uvIndex":2,"ozone":250.06},{"time":1508065200,"summary":"Clear","icon":"clear-day","precipIntensity":0,"precipProbability":0,"temperature":19.62,"apparentTemperature":19.62,"dewPoint":12.36,"humidity":0.63,"pressure":1023.21,"windSpeed":4.21,"windGust":6.33,"windBearing":188,"cloudCover":0,"uvIndex":2,"ozone":250.5},{"time":1508068800,"summary":"Clear","icon":"clear-day","precipIntensity":0,"precipProbability":0,"temperature":21.29,"apparentTemperature":21.29,"dewPoint":12.83,"humidity":0.59,"pressure":1022.78,"windSpeed":4.28,"windGust":6.28,"windBearing":191,"cloudCover":0,"uvIndex":2,"ozone":250.98},{"time":1508072400,"summary":"Clear","icon":"clear-day","precipIntensity":0,"precipProbability":0,"temperature":22.33,"apparentTemperature":22.33,"dewPoint":13.32,"humidity":0.57,"pressure":1022.3,"windSpeed":4.18,"windGust":6.45,"windBearing":191,"cloudCover":0,"uvIndex":2,"ozone":251.56},{"time":1508076000,"summary":"Clear","icon":"clear-day","precipIntensity":0,"precipProbability":0,"temperature":22.77,"apparentTemperature":22.77,"dewPoint":13.74,"humidity":0.57,"pressure":1021.84,"windSpeed":3.99,"windGust":6.71,"windBearing":192,"cloudCover":0,"uvIndex":1,"ozone":252.18},{"time":1508079600,"summary":"Clear","icon":"clear-day","precipIntensity":0.0025,"precipProbability":0.01,"precipType":"rain","temperature":22.43,"apparentTemperature":22.43,"dewPoint":13.87,"humidity":0.58,"pressure":1021.5,"windSpeed":3.87,"windGust":7.03,"windBearing":193,"cloudCover":0,"uvIndex":1,"ozone":252.76},{"time":1508083200,"summary":"Clear","icon":"clear-day","precipIntensity":0.0051,"precipProbability":0.01,"precipType":"rain","temperature":21.14,"apparentTemperature":21.14,"dewPoint":13.48,"humidity":0.62,"pressure":1021.45,"windSpeed":3.89,"windGust":7.38,"windBearing":194,"cloudCover":0,"uvIndex":0,"ozone":253.32},{"time":1508086800,"summary":"Clear","icon":"clear-night","precipIntensity":0.0051,"precipProbability":0.01,"precipType":"rain","temperature":19.19,"apparentTemperature":19.19,"dewPoint":12.79,"humidity":0.66,"pressure":1021.57,"windSpeed":3.98,"windGust":7.8,"windBearing":194,"cloudCover":0,"uvIndex":0,"ozone":253.89},{"time":1508090400,"summary":"Clear","icon":"clear-night","precipIntensity":0.0025,"precipProbability":0.01,"precipType":"rain","temperature":17.66,"apparentTemperature":17.66,"dewPoint":12.25,"humidity":0.71,"pressure":1021.68,"windSpeed":4.08,"windGust":8.33,"windBearing":196,"cloudCover":0,"uvIndex":0,"ozone":254.19},{"time":1508094000,"summary":"Clear","icon":"clear-night","precipIntensity":0.0025,"precipProbability":0.01,"precipType":"rain","temperature":16.7,"apparentTemperature":16.7,"dewPoint":12.06,"humidity":0.74,"pressure":1021.7,"windSpeed":4.24,"windGust":9.19,"windBearing":197,"cloudCover":0,"uvIndex":0,"ozone":254.32},{"time":1508097600,"summary":"Clear","icon":"clear-night","precipIntensity":0,"precipProbability":0,"temperature":16.06,"apparentTemperature":16.06,"dewPoint":12.02,"humidity":0.77,"pressure":1021.74,"windSpeed":4.42,"windGust":10.16,"windBearing":199,"cloudCover":0,"uvIndex":0,"ozone":254.36},{"time":1508101200,"summary":"Clear","icon":"clear-night","precipIntensity":0,"precipProbability":0,"temperature":15.57,"apparentTemperature":15.57,"dewPoint":11.98,"humidity":0.79,"pressure":1021.76,"windSpeed":4.52,"windGust":10.64,"windBearing":201,"cloudCover":0,"uvIndex":0,"ozone":254.15},{"time":1508104800,"summary":"Clear","icon":"clear-night","precipIntensity":0,"precipProbability":0,"temperature":15.21,"apparentTemperature":15.21,"dewPoint":11.89,"humidity":0.81,"pressure":1021.87,"windSpeed":4.47,"windGust":10.24,"windBearing":204,"cloudCover":0,"uvIndex":0,"ozone":253.7},{"time":1508108400,"summary":"Clear","icon":"clear-night","precipIntensity":0,"precipProbability":0,"temperature":15.11,"apparentTemperature":15.11,"dewPoint":11.81,"humidity":0.81,"pressure":1022,"windSpeed":4.36,"windGust":9.34,"windBearing":207,"cloudCover":0,"uvIndex":0,"ozone":252.92},{"time":1508112000,"summary":"Clear","icon":"clear-night","precipIntensity":0,"precipProbability":0,"temperature":15.08,"apparentTemperature":15.08,"dewPoint":11.75,"humidity":0.8,"pressure":1022.04,"windSpeed":4.25,"windGust":8.65,"windBearing":208,"cloudCover":0,"uvIndex":0,"ozone":252.13},{"time":1508115600,"summary":"Clear","icon":"clear-night","precipIntensity":0,"precipProbability":0,"temperature":15.02,"apparentTemperature":15.02,"dewPoint":11.67,"humidity":0.8,"pressure":1021.94,"windSpeed":4.2,"windGust":8.5,"windBearing":207,"cloudCover":0.06,"uvIndex":0,"ozone":251.33},{"time":1508119200,"summary":"Clear","icon":"clear-night","precipIntensity":0,"precipProbability":0,"temperature":14.96,"apparentTemperature":14.96,"dewPoint":11.59,"humidity":0.8,"pressure":1021.77,"windSpeed":4.16,"windGust":8.56,"windBearing":204,"cloudCover":0.14,"uvIndex":0,"ozone":250.45},{"time":1508122800,"summary":"Clear","icon":"clear-night","precipIntensity":0,"precipProbability":0,"temperature":14.66,"apparentTemperature":14.66,"dewPoint":11.56,"humidity":0.82,"pressure":1021.67,"windSpeed":4.07,"windGust":8.47,"windBearing":202,"cloudCover":0.23,"uvIndex":0,"ozone":249.64},{"time":1508126400,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipIntensity":0.0102,"precipProbability":0.02,"precipType":"rain","temperature":14.14,"apparentTemperature":14.14,"dewPoint":11.56,"humidity":0.84,"pressure":1021.63,"windSpeed":3.87,"windGust":8.06,"windBearing":202,"cloudCover":0.37,"uvIndex":0,"ozone":248.84},{"time":1508130000,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipIntensity":0.0508,"precipProbability":0.06,"precipType":"rain","temperature":13.63,"apparentTemperature":13.63,"dewPoint":11.58,"humidity":0.87,"pressure":1021.64,"windSpeed":3.63,"windGust":7.51,"windBearing":202,"cloudCover":0.52,"uvIndex":0,"ozone":248.12},{"time":1508133600,"summary":"Partly Cloudy","icon":"partly-cloudy-night","precipIntensity":0.0838,"precipProbability":0.08,"precipType":"rain","temperature":13.68,"apparentTemperature":13.68,"dewPoint":11.75,"humidity":0.88,"pressure":1021.67,"windSpeed":3.48,"windGust":7.07,"windBearing":201,"cloudCover":0.57,"uvIndex":0,"ozone":247.44},{"time":1508137200,"summary":"Partly Cloudy","icon":"partly-cloudy-day","precipIntensity":0.0508,"precipProbability":0.05,"precipType":"rain","temperature":14.53,"apparentTemperature":14.53,"dewPoint":12.13,"humidity":0.86,"pressure":1021.8,"windSpeed":3.51,"windGust":6.87,"windBearing":199,"cloudCover":0.42,"uvIndex":0,"ozone":247.08},{"time":1508140800,"summary":"Clear","icon":"clear-day","precipIntensity":0.0102,"precipProbability":0.02,"precipType":"rain","temperature":16.02,"apparentTemperature":16.02,"dewPoint":12.65,"humidity":0.8,"pressure":1021.93,"windSpeed":3.64,"windGust":6.77,"windBearing":196,"cloudCover":0.18,"uvIndex":1,"ozone":246.86},{"time":1508144400,"summary":"Clear","icon":"clear-day","precipIntensity":0,"precipProbability":0,"temperature":17.52,"apparentTemperature":17.52,"dewPoint":13.18,"humidity":0.76,"pressure":1021.95,"windSpeed":3.79,"windGust":6.67,"windBearing":193,"cloudCover":0,"uvIndex":1,"ozone":246.72},{"time":1508148000,"summary":"Clear","icon":"clear-day","precipIntensity":0,"precipProbability":0,"temperature":19.28,"apparentTemperature":19.28,"dewPoint":13.73,"humidity":0.7,"pressure":1021.87,"windSpeed":3.94,"windGust":6.5,"windBearing":192,"cloudCover":0,"uvIndex":2,"ozone":246.72},{"time":1508151600,"summary":"Clear","icon":"clear-day","precipIntensity":0,"precipProbability":0,"temperature":21.03,"apparentTemperature":21.03,"dewPoint":14.29,"humidity":0.65,"pressure":1021.7,"windSpeed":4.08,"windGust":6.31,"windBearing":190,"cloudCover":0,"uvIndex":2,"ozone":246.72},{"time":1508155200,"summary":"Clear","icon":"clear-day","precipIntensity":0,"precipProbability":0,"temperature":22.59,"apparentTemperature":22.59,"dewPoint":14.74,"humidity":0.61,"pressure":1021.43,"windSpeed":4.18,"windGust":6.32,"windBearing":188,"cloudCover":0,"uvIndex":2,"ozone":246.72},{"time":1508158800,"summary":"Clear","icon":"clear-day","precipIntensity":0,"precipProbability":0,"temperature":23.5,"apparentTemperature":23.5,"dewPoint":15.09,"humidity":0.59,"pressure":1020.94,"windSpeed":4.2,"windGust":6.63,"windBearing":184,"cloudCover":0,"uvIndex":2,"ozone":246.67}]},"daily":{"summary":"Light rain on Wednesday through next Saturday, with temperatures peaking at 24°C on Monday.","icon":"rain","data":[{"time":1507932000,"summary":"Clear throughout the day.","icon":"clear-day","sunriseTime":1507960816,"sunsetTime":1507999678,"moonPhase":0.82,"precipIntensity":0,"precipIntensityMax":0.0025,"precipIntensityMaxTime":1508007600,"precipProbability":0,"temperatureHigh":22.02,"temperatureHighTime":1507989600,"temperatureLow":11.26,"temperatureLowTime":1508043600,"apparentTemperatureHigh":22.06,"apparentTemperatureHighTime":1507989600,"apparentTemperatureLow":11.26,"apparentTemperatureLowTime":1508043600,"dewPoint":13.97,"humidity":0.85,"pressure":1025.86,"windSpeed":2.28,"windGust":5.83,"windGustTime":1507942800,"windBearing":222,"cloudCover":0.14,"uvIndex":2,"uvIndexTime":1507975200,"visibility":9.61,"ozone":262.24,"temperatureMin":12.96,"temperatureMinTime":1507960800,"temperatureMax":22.02,"temperatureMaxTime":1507989600,"apparentTemperatureMin":12.96,"apparentTemperatureMinTime":1507960800,"apparentTemperatureMax":22.06,"apparentTemperatureMaxTime":1507989600},{"time":1508018400,"summary":"Clear throughout the day.","icon":"clear-day","sunriseTime":1508047318,"sunsetTime":1508085949,"moonPhase":0.85,"precipIntensity":0.0025,"precipIntensityMax":0.0051,"precipIntensityMaxTime":1508022000,"precipProbability":0.05,"precipType":"rain","temperatureHigh":22.77,"temperatureHighTime":1508076000,"temperatureLow":13.63,"temperatureLowTime":1508130000,"apparentTemperatureHigh":22.77,"apparentTemperatureHighTime":1508076000,"apparentTemperatureLow":13.63,"apparentTemperatureLowTime":1508130000,"dewPoint":11.72,"humidity":0.75,"pressure":1023.45,"windSpeed":3.25,"windGust":10.64,"windGustTime":1508101200,"windBearing":185,"cloudCover":0,"uvIndex":2,"uvIndexTime":1508061600,"ozone":252.1,"temperatureMin":11.26,"temperatureMinTime":1508043600,"temperatureMax":22.77,"temperatureMaxTime":1508076000,"apparentTemperatureMin":11.26,"apparentTemperatureMinTime":1508043600,"apparentTemperatureMax":22.77,"apparentTemperatureMaxTime":1508076000},{"time":1508104800,"summary":"Partly cloudy in the morning.","icon":"partly-cloudy-night","sunriseTime":1508133819,"sunsetTime":1508172221,"moonPhase":0.89,"precipIntensity":0.0102,"precipIntensityMax":0.0838,"precipIntensityMaxTime":1508133600,"precipProbability":0.11,"precipType":"rain","temperatureHigh":23.88,"temperatureHighTime":1508162400,"temperatureLow":12.63,"temperatureLowTime":1508220000,"apparentTemperatureHigh":23.88,"apparentTemperatureHighTime":1508162400,"apparentTemperatureLow":12.63,"apparentTemperatureLowTime":1508220000,"dewPoint":12.94,"humidity":0.74,"pressure":1021.25,"windSpeed":4.1,"windGust":10.55,"windGustTime":1508187600,"windBearing":194,"cloudCover":0.1,"uvIndex":2,"uvIndexTime":1508148000,"ozone":248.35,"temperatureMin":13.63,"temperatureMinTime":1508130000,"temperatureMax":23.88,"temperatureMaxTime":1508162400,"apparentTemperatureMin":13.63,"apparentTemperatureMinTime":1508130000,"apparentTemperatureMax":23.88,"apparentTemperatureMaxTime":1508162400},{"time":1508191200,"summary":"Mostly cloudy throughout the day.","icon":"partly-cloudy-day","sunriseTime":1508220322,"sunsetTime":1508258494,"moonPhase":0.92,"precipIntensity":0,"precipIntensityMax":0.0051,"precipIntensityMaxTime":1508256000,"precipProbability":0,"temperatureHigh":20.33,"temperatureHighTime":1508248800,"temperatureLow":11.89,"temperatureLowTime":1508302800,"apparentTemperatureHigh":20.33,"apparentTemperatureHighTime":1508248800,"apparentTemperatureLow":11.89,"apparentTemperatureLowTime":1508302800,"dewPoint":11.9,"humidity":0.76,"pressure":1020.22,"windSpeed":2.67,"windGust":10.7,"windGustTime":1508191200,"windBearing":204,"cloudCover":0.77,"uvIndex":1,"uvIndexTime":1508230800,"ozone":250.83,"temperatureMin":12.63,"temperatureMinTime":1508220000,"temperatureMax":20.33,"temperatureMaxTime":1508248800,"apparentTemperatureMin":12.63,"apparentTemperatureMinTime":1508220000,"apparentTemperatureMax":20.33,"apparentTemperatureMaxTime":1508248800},{"time":1508277600,"summary":"Light rain overnight.","icon":"rain","sunriseTime":1508306824,"sunsetTime":1508344768,"moonPhase":0.96,"precipIntensity":0.0229,"precipIntensityMax":0.188,"precipIntensityMaxTime":1508360400,"precipProbability":0.24,"precipType":"rain","temperatureHigh":18.94,"temperatureHighTime":1508338800,"temperatureLow":10.97,"temperatureLowTime":1508392800,"apparentTemperatureHigh":18.94,"apparentTemperatureHighTime":1508338800,"apparentTemperatureLow":10.97,"apparentTemperatureLowTime":1508392800,"dewPoint":11.37,"humidity":0.79,"pressure":1011.72,"windSpeed":4.39,"windGust":12.03,"windGustTime":1508360400,"windBearing":180,"cloudCover":0.75,"uvIndex":1,"uvIndexTime":1508317200,"ozone":253.58,"temperatureMin":11.89,"temperatureMinTime":1508302800,"temperatureMax":18.94,"temperatureMaxTime":1508338800,"apparentTemperatureMin":11.89,"apparentTemperatureMinTime":1508302800,"apparentTemperatureMax":18.94,"apparentTemperatureMaxTime":1508338800},{"time":1508364000,"summary":"Light rain until afternoon, starting again in the evening.","icon":"rain","sunriseTime":1508393327,"sunsetTime":1508431043,"moonPhase":0.99,"precipIntensity":0.193,"precipIntensityMax":0.7569,"precipIntensityMaxTime":1508436000,"precipProbability":0.65,"precipType":"rain","temperatureHigh":15.6,"temperatureHighTime":1508414400,"temperatureLow":10.53,"temperatureLowTime":1508479200,"apparentTemperatureHigh":15.6,"apparentTemperatureHighTime":1508414400,"apparentTemperatureLow":10.53,"apparentTemperatureLowTime":1508479200,"dewPoint":11.47,"humidity":0.88,"pressure":1004.96,"windSpeed":6.05,"windGust":18.37,"windGustTime":1508436000,"windBearing":221,"cloudCover":0.63,"uvIndex":1,"uvIndexTime":1508400000,"ozone":273.85,"temperatureMin":10.97,"temperatureMinTime":1508392800,"temperatureMax":15.6,"temperatureMaxTime":1508414400,"apparentTemperatureMin":10.97,"apparentTemperatureMinTime":1508392800,"apparentTemperatureMax":15.6,"apparentTemperatureMaxTime":1508414400},{"time":1508450400,"summary":"Breezy throughout the day and drizzle in the afternoon and overnight.","icon":"rain","sunriseTime":1508479830,"sunsetTime":1508517319,"moonPhase":0.03,"precipIntensity":0.0762,"precipIntensityMax":0.188,"precipIntensityMaxTime":1508500800,"precipProbability":0.59,"precipType":"rain","temperatureHigh":13.68,"temperatureHighTime":1508500800,"temperatureLow":8.27,"temperatureLowTime":1508540400,"apparentTemperatureHigh":13.68,"apparentTemperatureHighTime":1508500800,"apparentTemperatureLow":3.86,"apparentTemperatureLowTime":1508540400,"dewPoint":9.17,"humidity":0.82,"pressure":1004.07,"windSpeed":9.21,"windGust":12.74,"windGustTime":1508450400,"windBearing":230,"cloudCover":0.53,"uvIndex":1,"uvIndexTime":1508486400,"ozone":291.59,"temperatureMin":9.41,"temperatureMinTime":1508533200,"temperatureMax":14.74,"temperatureMaxTime":1508468400,"apparentTemperatureMin":5.03,"apparentTemperatureMinTime":1508533200,"apparentTemperatureMax":14.74,"apparentTemperatureMaxTime":1508468400},{"time":1508536800,"summary":"Breezy in the morning and light rain throughout the day.","icon":"rain","sunriseTime":1508566334,"sunsetTime":1508603596,"moonPhase":0.06,"precipIntensity":0.5283,"precipIntensityMax":1.2065,"precipIntensityMaxTime":1508601600,"precipProbability":0.71,"precipType":"rain","temperatureHigh":14.87,"temperatureHighTime":1508580000,"temperatureLow":8.91,"temperatureLowTime":1508648400,"apparentTemperatureHigh":14.87,"apparentTemperatureHighTime":1508580000,"apparentTemperatureLow":5.83,"apparentTemperatureLowTime":1508652000,"dewPoint":8.94,"humidity":0.8,"pressure":1005.1,"windSpeed":8.59,"windGust":20.39,"windGustTime":1508576400,"windBearing":227,"cloudCover":0.66,"uvIndex":1,"uvIndexTime":1508576400,"ozone":276.87,"temperatureMin":8.27,"temperatureMinTime":1508540400,"temperatureMax":14.87,"temperatureMaxTime":1508580000,"apparentTemperatureMin":3.86,"apparentTemperatureMinTime":1508540400,"apparentTemperatureMax":14.87,"apparentTemperatureMaxTime":1508580000}]},"flags":{"sources":["isd","cmc","gfs","madis"],"isd-stations":["063700-99999","063750-99999","063770-99999","063850-99999","063910-99999","064640-99999","064790-99999","064810-99999","100001-99999","104010-99999","104020-99999","104040-99999","104043-99999","104050-99999","104374-99999","105000-99999"],"units":"si"},"offset":2}});
});

app.get('/quote*', (request, response) => {
	fetch('https://quotesondesign.com/wp-json/posts?filter[orderby]=rand&filter[posts_per_page]=1&callback=', https, URL).then(data => {
		response.send({success: true, data: data[0]});
	}).catch(err => {
		response.send({success: false, error: err})
	});

	// response.send({"success":true,"data":{"ID":1006,"title":"John Maeda","content":"<p>If you are going to have less things, they have to be great things.  </p>\n","link":"https://quotesondesign.com/john-maeda-2/"}});
});

app.get('/todo*', (request, response) => {
	// Confidential...
});

app.get('/news*', (request, response) => {
	fetch('https://newsapi.org/v1/articles?source=google-news&sortBy=top&apiKey=' + config.news.apiKey, https, URL).then(data => {
		if (data.status == 'ok')
			response.send({success: true, data: data.articles});
		else
			response.send({success: false, error: data.message});
	}).catch(err => {
		response.send({success: false, error: err});
	});

	// response.send({"success":true,"data":[{"author":"Kurtis Lee","title":"The newest step in the evolution of the Boy Scouts: accepting girls","description":"In a historic change, the Boy Scouts are announcing plans to admit girls into the Cub Scouts starting next year and to establish a new program for older girls using the same curriculum as the Boy Scouts.","url":"http://www.latimes.com/nation/la-na-boy-scouts-girls-20171011-story.html","urlToImage":"http://www.trbimg.com/img-59de6cea/turbine/la-na-boy-scouts-girls-20171011","publishedAt":"2017-10-11T18:55:00Z"},{"author":"Peter Baker and Cecilia Kang","title":"Trump Threatens NBC Over Nuclear Weapons Report","description":"The president said he might use the power of the federal government to retaliate by challenging broadcast licenses.","url":"https://www.nytimes.com/2017/10/11/us/politics/trump-nbc-fcc-broadcast-license.html","urlToImage":"https://static01.nyt.com/images/2017/10/12/us/12dc-trumpnbc/12dc-trumpnbc-facebookJumbo.jpg","publishedAt":"2017-10-11T18:33:29Z"},{"author":"https://www.facebook.com/CleveWootson, https://www.facebook.com/kristineaguerra, https://www.facebook.com/jlachenbach","title":"‘A serious, critical, catastrophic event’: At least 21 dead as California wildfires spread","description":"\"This has been one of the deadliest weeks for fires that we've experienced in recent time,” a Cal Fire official said.","url":"https://www.washingtonpost.com/news/post-nation/wp/2017/10/10/pure-devastation-at-least-15-dead-as-firefighters-struggle-to-weaken-california-fires/","urlToImage":"https://www.washingtonpost.com/resizer/4qw5UdIprtJAvBCKoBfpvwJJDY4=/1484x0/https://arc-anglerfish-washpost-prod-washpost.s3.amazonaws.com/public/MLH4HRTPF46H5OI6ZILSFUSPMI.jpg","publishedAt":"2017-10-11T18:46:00Z"},{"author":"https://www.facebook.com/mariasacchettireporter","title":"Trump expected to tap Kirstjen Nielsen to lead Department of Homeland Security","description":"Nielsen, a cybersecurity expert who served as Kelly’s chief of staff when he was DHS secretary, accompanied him to the White House as his deputy and quickly emerged as a controversial presence.","url":"https://www.washingtonpost.com/politics/trump-expected-to-tap-kirstjen-nielsen-to-lead-department-of-homeland-security/2017/10/11/21770f8e-aeaf-11e7-9e58-e6288544af98_story.html","urlToImage":"https://img.washingtonpost.com/rf/image_1484w/2010-2019/WashingtonPost/2017/10/11/Others/Images/2017-10-05/AP_17234860899492.JPG?t=20170517","publishedAt":"2017-10-11T18:11:24Z"},{"author":"Ana Swanson","title":"Trump’s Tough Talk on Nafta Raising Fears of Pact’s Demise","description":"The president has long talked about scrapping Nafta. Even skeptics are starting to believe him.","url":"https://www.nytimes.com/2017/10/11/business/economy/nafta-trump.html","urlToImage":"https://static01.nyt.com/images/2017/10/12/us/12dcnafta-alpha/12dcnafta-alpha-facebookJumbo.jpg","publishedAt":"2017-10-11T18:40:00Z"},{"author":"https://www.facebook.com/elahei","title":"Gwyneth Paltrow, Angelina Jolie, Cara Delevingne join the growing list of Harvey Weinstein accusers","description":"More than a dozen woman have accused Weinstein of making unwanted sexual advances. Some have said he raped them.","url":"https://www.washingtonpost.com/news/arts-and-entertainment/wp/2017/10/10/more-than-a-dozen-women-have-publicly-accused-harvey-weinstein-of-sexual-misconduct/","urlToImage":"https://img.washingtonpost.com/rf/image_1484w/2010-2019/WashingtonPost/2017/10/10/Style/Videos/Images/t_1507633025731_name_gettyimages_weinstein_profile_copy.jpg?t=20170517","publishedAt":"2017-10-11T18:11:15Z"},{"author":null,"title":"Las Vegas shooter reportedly used hotel freight elevator as high-rolling perk","description":"A Las Vegas bellhop may have unwittingly helped Stephen Paddock carry his arsenal of weapons and ammunition up a freight elevator Paddock accessed through a special hotel perk and into the out-of-view 32nd-floor suite Paddock used to rain down mayhem on a country music concert crowd.","url":"http://www.foxnews.com/us/2017/10/11/bellhop-reportedly-helped-las-vegas-gunman-with-bags-as-resort-cops-differ-over-timeline.html","urlToImage":"//a57.foxnews.com/media2.foxnews.com/BrightCove/694940094001/2017/10/10/0/0/694940094001_5604265099001_5604243284001-vs.jpg?ve=1","publishedAt":"2017-10-11T15:54:10Z"},{"author":null,"title":"A good economy is bad for tax cut chances","description":"So what would a bad economy mean?","url":"http://www.foxnews.com/politics/2017/10/11/good-economy-is-bad-for-tax-cut-chances.html","urlToImage":"//a57.foxnews.com/media2.foxnews.com/BrightCove/694940094001/2017/10/11/0/0/694940094001_5605848804001_5605811379001-vs.jpg?ve=1","publishedAt":"2017-10-11T16:01:24Z"},{"author":"Mike Miller","title":"Ben Affleck ‘Sincerely’ Apologizes for Acting ‘Inappropriately’ Towards Hilarie Burton on TRL","description":"\"I acted inappropriately toward Ms. Burton and I sincerely apologize,\" Affleck tweeted on Wednesday.","url":"http://people.com/movies/ben-affleck-sincerely-apologizes-for-acting-inappropriately-towards-hilarie-burton-on-trl/","urlToImage":"http://peopledotcom.files.wordpress.com/2017/10/ben-affleck3.jpg?crop=0px%2C0px%2C1024px%2C538px&resize=1200%2C630","publishedAt":"2017-10-11T17:45:07Z"},{"author":null,"title":"AP-NORC Poll: Most say Trump making NKorea situation worse","description":"North Korea’s nuclear weapons development is spooking most Americans, and two-thirds of them say President Donald Trump’s war of words with the isolated nation’s leader is making the situation worse. Less than 1 in 10 thinks Trump’s comments are making it better.","url":"https://www.washingtonpost.com/world/national-security/ap-norc-poll-most-say-trump-making-nkorea-situation-worse/2017/10/11/397eff8c-ae8d-11e7-9b93-b97043e57a22_story.html","urlToImage":"https://img.washingtonpost.com/rf/image_1484w/2010-2019/Wires/Online/2017-10-11/AP/Images/AP_Poll_North_Korea_41588.jpg-6ffd9.jpg?t=20170517","publishedAt":"2017-10-11T14:13:24Z"}]});
});

app.get('/githubNotifications*', (request, response) => {
	const headers = {
		'User-Agent':'Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 6.0)',
		'authorization': 'Basic ' + new Buffer(config.github.username + ':' + config.github.password).toString('base64')
	}

	fetch('https://api.github.com/notifications', https, URL, headers).then(data => {
		response.send({success: true, data: data});
	}).catch(err => {
		response.send({success: false, error: err});
	});

	// response.send({success: true, data: []});
});

app.get('*', (request, response) => {
	let path = __dirname + `/${request.url}`;

	if (path.endsWith('/'))
		path = path + 'index.html';

	fs.exists(path, exists => {
		if (exists) {
			if (PATH.extname(path) == '.html') {
				fs.readFile(path, 'utf-8', (err, data) => {
					if (err) response.status(500).send('Error: 500. An error occured: ' + err);
					else {
						for (key in config.webInterface)
							data = data.replace(new RegExp(`\{\{${key}\}\}`, 'g'), config.webInterface[key]);

						response.status(200).send(data);
					}
				});
			} else response.status(200).sendFile(path);
		} else response.status(404).send('File not found');
	});
});

app.listen(8000, err => {
	if (err)
		console.log('Err', err);
	else
		console.log('Online!');
});